#**********************************************************************************
#generated by Trengen
#**********************************************************************************

cmake_minimum_required(VERSION 2.6)
project(BasicCalculatorGen)


#---------------------------
# MY_FIND_BOOST_LIBRARY
#---------------------------
#Finds boost libraries in trentino's default 3rdParty directory.
#On Windows boost lib's file names are decorated. For example: 
#boost_date_time-vc90-mt-1_44 (release) or boost_date_time-vc90-mt-gd-1_44 (debug)
#Hence this macro expects and accepts only multithreaded variants for MSVC 2008
#with version 1.44 (=>TODO)
#---------------------------
macro(MY_FIND_BOOST_LIBRARY var baseLibName buildType)		 
	set(realLibName ${baseLibName})
	set (MYBOOST_VERSION ".1.44.0")
	if(WIN32)		
		if(MSVC10)
			set(msvcVersion "100")
		elseif(MSVC90)
			set(msvcVersion "90")
		endif()
		set(realLibName ${realLibName}-vc${msvcVersion}-mt)
		if(${buildType} STREQUAL "debug")
			set(realLibName ${realLibName}-gd)
		endif()
		set(realLibName ${realLibName}-1_44)
	else()
	    set(realLibName lib${realLibName}${CMAKE_SHARED_LIBRARY_SUFFIX}${MYBOOST_VERSION})
	endif()
		
	if(${buildType} STREQUAL "debug")
		set(path ${TRENTINO_BOOST_LIB_DIR_DEBUG})
	else()
		set(path ${TRENTINO_BOOST_LIB_DIR_RELEASE})
	endif()	
	MY_FIND_LIBRARY(${var} ${realLibName} ${path})	
	#find_library(${var} ${realLibName} PATHS ${boostDir}/lib/${buildType} NO_DEFAULT_PATH)			
endmacro(MY_FIND_BOOST_LIBRARY)

#----------------------------------
# MAKE_DLL_NAME
#----------------------------------
#Replaces the file extension of the given library file path with
#the os specific shared/dynamic library extension
#---------------------------------
macro(MAKE_DLL_NAME libraryFilePath dllFilePath)
	get_filename_component(libraryPath ${libraryFilePath} PATH)
	get_filename_component(libraryFileName ${libraryFilePath} NAME_WE)	
	set(${dllFilePath} ${libraryPath}/${libraryFileName}${CMAKE_SHARED_LIBRARY_SUFFIX} CACHE PATH "")		
endmacro(MAKE_DLL_NAME)

#----------------------------------
# MY_FIND_LIBRARY
#----------------------------------
#Searches a library in the specified path and prints an error message on failure
#used by MY_FIND_* macros contained in the corresponding my_find_*.cmake files
#---------------------------
macro(MY_FIND_LIBRARY var lib path)
	find_library(${var} ${lib} PATHS ${path})	
	if(NOT ${var})		
		message(SEND_ERROR "Library ${var} ${lib} ${path} not found")
	endif()
endmacro(MY_FIND_LIBRARY)

##############################################################################
# 								COMPILER OPTIONS  							 #
##############################################################################
if(MSVC)
	add_definitions(-DUNICODE -D_UNICODE)
	add_definitions(/W4)
	add_definitions(/WX)
    add_definitions(/wd4251)
    add_definitions(/wd4275)
else()
	add_definitions(-Wall -pedantic)
endif()

##############################################################################
# 							   OUTPUT CONFIGURATION						     #
##############################################################################

set(EXECUTABLE_OUTPUT_PATH ${CMAKE_BINARY_DIR}/build/${CMAKE_SYSTEM_PROCESSOR}${CMAKE_SYSTEM_NAME})
set(LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR}/build/${CMAKE_SYSTEM_PROCESSOR}${CMAKE_SYSTEM_NAME} )
set(Contribution_Dir ${my_root_dir})
set(Include_Dir ${my_root_dir})
option(USE_TRENTINO_LIB_DIR "USE trentino lib dir" ON)
set(TRENTINO_RUNTIME_DIR I:/Trentino/trentino/Binaries/trentino_x86_windows_0.2-pa)
set(TRENTINO_LIB_DIR ${TRENTINO_RUNTIME_DIR}/lib)
set(my_root_dir I:/Trentino/trentino/DEV/cpp/src/Tests/SystemTestData/ContributionInfoTestData/BasicCalculator)
set (DEFAULT_INSTALL_PATH I:/Trentino/trentino/DEV/cpp/src/Tests/SystemTestData/ContributionInfoTestData)

if (CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
   set (CMAKE_INSTALL_PREFIX I:/Trentino/trentino/DEV/cpp/src/Tests/SystemTestData/ContributionInfoTestData CACHE STRING "Install path" FORCE)
endif()

set(boost_folder_with_version boost_1_44)
set(TRENTINO_BOOST_LIB_DIR_RELEASE ${TRENTINO_LIB_DIR}/${boost_folder_with_version})
set(TRENTINO_BOOST_LIB_DIR_DEBUG ${TRENTINO_LIB_DIR}/${boost_folder_with_version})
MY_FIND_BOOST_LIBRARY(Boost_SYSTEM_LIBRARY_RELEASE boost_system	release)

#header files
FILE(GLOB BasicCalculatorGenHEADER_FILES *.h *.inl)	  

#source files
FILE(GLOB BasicCalculatorGenSOURCE_FILES *.cpp)	  

set ( BasicCalculatorGenSOURCE_FILES
	  ${BasicCalculatorGenHEADER_FILES} ${BasicCalculatorGenSOURCE_FILES})  


	  
#libs
set( BasicCalculatorGenTHIRD_PARTY_LIBS
     TrentinoRuntime BasicCalculator TrentinoBindingSCA ${Boost_SYSTEM_LIBRARY_RELEASE}
     )
	 
set( BasicCalculatorGenCUSTOM_LIBS )


if (WIN32)
	add_definitions(-DBASICCALCULATORGEN_EXPORTS)
endif()

include_directories(${TRENTINO_RUNTIME_DIR}/include 
                    ${TRENTINO_RUNTIME_DIR}/include/Binding/SCA 
					${TRENTINO_RUNTIME_DIR}/include/protobuf-2.4.1/include 
					${Contribution_Dir} 
					${Contribution_Dir}/services 
					${Contribution_Dir}/include ${Include_Dir})
link_directories(I:/Trentino/trentino/Binaries/trentino_x86_windows_0.2-pa/lib 
                 ${my_root_dir} ${my_root_dir}/lib )

add_library(BasicCalculatorGen SHARED ${BasicCalculatorGenSOURCE_FILES})
set_target_properties(BasicCalculatorGen PROPERTIES OUTPUT_NAME sca-contribution)

set(target_location "")
set(target_path "")
#set(target_file_name "")
get_target_property(target_location BasicCalculatorGen LOCATION)

get_filename_component(target_path ${target_location} PATH)
set(new_path ${target_path}/BasicCalculatorGen/META-INF)
#get_filename_component(target_file_name ${target_location}
add_custom_command( TARGET BasicCalculatorGen POST_BUILD
					COMMAND  ${CMAKE_COMMAND} -E make_directory ${new_path}
					COMMAND ${CMAKE_COMMAND} -E copy ${target_location} ${new_path} 
					VERBATIM)

target_link_libraries(BasicCalculatorGen ${BasicCalculatorGenCUSTOM_LIBS})
target_link_libraries(BasicCalculatorGen ${BasicCalculatorGenTHIRD_PARTY_LIBS})
set(MY_GEN_INSTALL_DIR BasicCalculator)
install(TARGETS BasicCalculatorGen  ${DLL_TARGET_KIND} DESTINATION ${MY_GEN_INSTALL_DIR}/META-INF ARCHIVE DESTINATION ${TARGET_LIB_DIR})
install(FILES sca-contribution.conf DESTINATION ${MY_GEN_INSTALL_DIR}/META-INF)